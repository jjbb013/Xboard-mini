# Northflank 部署流程 (最终版)

本文档是部署 Xboard 应用到 Northflank 平台的最终、最详细的操作指南。请严格按照此流程操作，以确保部署成功。

## 1. 核心部署策略

我们采用 **单服务 + SupervisorD + Entrypoint 脚本** 的最终模型。所有配置均已通过 `northflank.yml` 文件定义。**您的任务是触发自动化部署，并验证其正确性，而不是手动配置。**

---

## 2. 部署前的唯一前提

确保我们所有的最新代码修改（包括 `PROJECT.md`, `Dockerfile`, `northflank.yml`, `entrypoint.sh` 等）都已推送到您的 GitHub 仓库的 `master` 分支。

---

## 3. 详细部署操作步骤

### 步骤一：删除旧的、失败的服务

为了避免任何缓存或旧配置的干扰，请**首先在您的 Northflank 项目中，彻底删除之前创建的、所有失败的服务和插件（包括存储卷）**。我们需要从一个完全干净的状态开始。

### 步骤二：从 Git 仓库创建新服务

1.  在您的 Northflank 项目中，点击 **"Create new service"**。
2.  根据官方文档，选择 **"Combined service"**。这个选项会将从源代码构建和部署两个步骤合并在一起，完全由我们的配置文件驱动。
3.  选择您的 GitHub 账户，并选择 `jjbb013/Xboard-mini` 仓库。
4.  选择 `master` 分支。

### 步骤三：让 Northflank 自动解析配置

1.  Northflank 现在会自动检测并解析您仓库中的 `northflank.yml` 文件。
2.  它会直接带您进入一个**部署计划概览**页面。**您不会被要求手动填写服务名称、端口、环境变量等信息。** 如果您看到了需要手动填写的表单，说明您选择了错误的创建流程，请返回并重新从步骤二开始。

### 步骤四：验证部署计划

在这个部署计划概览页面上，您会看到 Northflank 即将为您创建的资源。**您的任务是验证，而不是修改**。请仔细核对以下几点：

-   **Services (1)**:
    -   服务名称应为 `xboard`。
    -   服务类型应为 `web`。
    -   **端口应为 `7002`，协议应为 `HTTP`**。
-   **Addons (1)**:
    -   插件名称应为 `xboard-data`。
    -   插件类型应为 `storage`。
-   **Build Options**:
    -   应显示它将使用 `Dockerfile` 进行构建。
-   **Environment Variables**:
    -   您应该能看到 `DB_CONNECTION=database`, `CACHE_DRIVER=database` 等环境变量。
    -   `APP_KEY` 应该显示为 `[generated]` 或类似的状态，表示将由平台自动生成。

### 步骤五：启动部署

只要上述所有信息都与 `northflank.yml` 的内容一致，您就可以放心地点击 **"Create service"** 或 **"Deploy"** 按钮。

Northflank 现在将完全按照我们的配置文件，自动执行所有构建、初始化和启动步骤。部署完成后，您应该能通过 Northflank 提供的公开域名访问您的网站，并且 `octane` 和 `queue-worker` 两个进程都应该能稳定运行。
